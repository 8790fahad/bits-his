"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _glamor = require("glamor");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _constants = require("../../constants");

var _Toast = _interopRequireDefault(require("./Toast"));

var wrapperClass = (0, _glamor.css)({
  maxWidth: 560,
  margin: '0 auto',
  top: 0,
  left: 0,
  right: 0,
  position: 'fixed',
  zIndex: _constants.StackingOrder.TOASTER,
  pointerEvents: 'none'
});

var ToastManager =
/*#__PURE__*/
function (_React$PureComponent) {
  (0, _inherits2.default)(ToastManager, _React$PureComponent);

  function ToastManager(props, context) {
    var _this;

    (0, _classCallCheck2.default)(this, ToastManager);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(ToastManager).call(this, props, context));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "getToasts", function () {
      return _this.state.toasts;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "closeAll", function () {
      _this.getToasts().forEach(function (toast) {
        return toast.close();
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "notify", function (title, settings) {
      var instance = _this.createToastInstance(title, settings);

      _this.setState(function (previousState) {
        return {
          toasts: [instance].concat((0, _toConsumableArray2.default)(previousState.toasts))
        };
      });

      return instance;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "createToastInstance", function (title, settings) {
      var id = ++ToastManager.idCounter;
      return {
        id: id,
        title: title,
        description: settings.description,
        hasCloseButton: settings.hasCloseButton || true,
        duration: settings.duration || 5,
        close: function close() {
          return _this.closeToast(id);
        },
        intent: settings.intent
      };
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "closeToast", function (id) {
      _this.setState(function (previousState) {
        return {
          toasts: previousState.toasts.map(function (toast) {
            if (toast.id === id) {
              return (0, _objectSpread2.default)({}, toast, {
                isShown: false
              });
            }

            return toast;
          })
        };
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "removeToast", function (id) {
      _this.setState(function (previousState) {
        return {
          toasts: previousState.toasts.filter(function (toast) {
            return toast.id !== id;
          })
        };
      });
    });
    props.bindNotify(_this.notify);
    props.bindGetToasts(_this.getToasts);
    props.bindCloseAll(_this.closeAll);
    _this.state = {
      toasts: []
    };
    return _this;
  }

  (0, _createClass2.default)(ToastManager, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      return _react.default.createElement("span", {
        className: wrapperClass
      }, this.state.toasts.map(function (_ref) {
        var id = _ref.id,
            description = _ref.description,
            props = (0, _objectWithoutProperties2.default)(_ref, ["id", "description"]);
        return _react.default.createElement(_Toast.default, (0, _extends2.default)({
          key: id,
          onRemove: function onRemove() {
            return _this2.removeToast(id);
          }
        }, props), description);
      }));
    }
  }]);
  return ToastManager;
}(_react.default.PureComponent);

exports.default = ToastManager;
ToastManager.displayName = "ToastManager";
(0, _defineProperty2.default)(ToastManager, "propTypes", {
  /**
   * Function called with the `this.notify` function.
   */
  bindNotify: _propTypes.default.func.isRequired,

  /**
   * Function called with the `this.getToasts` function.
   */
  bindGetToasts: _propTypes.default.func.isRequired,

  /**
   * Function called with the `this.closeAll` function.
   */
  bindCloseAll: _propTypes.default.func.isRequired
});
(0, _defineProperty2.default)(ToastManager, "idCounter", 0);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdE1hbmFnZXIuanMiXSwibmFtZXMiOlsid3JhcHBlckNsYXNzIiwibWF4V2lkdGgiLCJtYXJnaW4iLCJ0b3AiLCJsZWZ0IiwicmlnaHQiLCJwb3NpdGlvbiIsInpJbmRleCIsIlN0YWNraW5nT3JkZXIiLCJUT0FTVEVSIiwicG9pbnRlckV2ZW50cyIsIlRvYXN0TWFuYWdlciIsInByb3BzIiwiY29udGV4dCIsInN0YXRlIiwidG9hc3RzIiwiZ2V0VG9hc3RzIiwiZm9yRWFjaCIsInRvYXN0IiwiY2xvc2UiLCJ0aXRsZSIsInNldHRpbmdzIiwiaW5zdGFuY2UiLCJjcmVhdGVUb2FzdEluc3RhbmNlIiwic2V0U3RhdGUiLCJwcmV2aW91c1N0YXRlIiwiaWQiLCJpZENvdW50ZXIiLCJkZXNjcmlwdGlvbiIsImhhc0Nsb3NlQnV0dG9uIiwiZHVyYXRpb24iLCJjbG9zZVRvYXN0IiwiaW50ZW50IiwibWFwIiwiaXNTaG93biIsImZpbHRlciIsImJpbmROb3RpZnkiLCJub3RpZnkiLCJiaW5kR2V0VG9hc3RzIiwiYmluZENsb3NlQWxsIiwiY2xvc2VBbGwiLCJyZW1vdmVUb2FzdCIsIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsIlByb3BUeXBlcyIsImZ1bmMiLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBTUEsWUFBWSxHQUFHLGlCQUFJO0FBQ3ZCQyxFQUFBQSxRQUFRLEVBQUUsR0FEYTtBQUV2QkMsRUFBQUEsTUFBTSxFQUFFLFFBRmU7QUFHdkJDLEVBQUFBLEdBQUcsRUFBRSxDQUhrQjtBQUl2QkMsRUFBQUEsSUFBSSxFQUFFLENBSmlCO0FBS3ZCQyxFQUFBQSxLQUFLLEVBQUUsQ0FMZ0I7QUFNdkJDLEVBQUFBLFFBQVEsRUFBRSxPQU5hO0FBT3ZCQyxFQUFBQSxNQUFNLEVBQUVDLHlC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RWY7QUFBakIsU0FDRyxLQUFLYyxLQUFMLENBQVdDLE1BQVgsQ0FBa0JrQixHQUFsQixDQUFzQixnQkFBbUM7QUFBQSxZQUFoQ1AsRUFBZ0MsUUFBaENBLEVBQWdDO0FBQUEsWUFBNUJFLFdBQTRCLFFBQTVCQSxXQUE0QjtBQUFBLFlBQVpoQixLQUFZO0FBQ3hELGVBQ0UsNkJBQUMsY0FBRDtBQUFPLFVBQUEsR0FBRyxFQUFFYyxFQUFaO0FBQWdCLFVBQUEsUUFBUSxFQUFFO0FBQUEsbUJBQU0sTUFBSSxDQUFDZSxXQUFMLENBQWlCZixFQUFqQixDQUFOO0FBQUE7QUFBMUIsV0FBMERkLEtBQTFELEdBQ0dnQixXQURILENBREY7QUFLRCxPQU5BLENBREgsQ0FERjtBQVdEOzs7RUExR3VDYyxlQUFNQyxhOzs7QUFBM0JoQyxZOzhCQUFBQSxZLGVBQ0E7QUFDakI7OztBQUdBeUIsRUFBQUEsVUFBVSxFQUFFUSxtQkFBVUMsSUFBVixDQUFlQyxVQUpWOztBQU1qQjs7O0FBR0FSLEVBQUFBLGFBQWEsRUFBRU0sbUJBQVVDLElBQVYsQ0FBZUMsVUFUYjs7QUFXakI7OztBQUdBUCxFQUFBQSxZQUFZLEVBQUVLLG1CQUFVQyxJQUFWLENBQWVDO0FBZFosQzs4QkFEQW5DLFksZUFrQkEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcidcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IFN0YWNraW5nT3JkZXIgfSBmcm9tICcuLi8uLi9jb25zdGFudHMnXG5pbXBvcnQgVG9hc3QgZnJvbSAnLi9Ub2FzdCdcblxuY29uc3Qgd3JhcHBlckNsYXNzID0gY3NzKHtcbiAgbWF4V2lkdGg6IDU2MCxcbiAgbWFyZ2luOiAnMCBhdXRvJyxcbiAgdG9wOiAwLFxuICBsZWZ0OiAwLFxuICByaWdodDogMCxcbiAgcG9zaXRpb246ICdmaXhlZCcsXG4gIHpJbmRleDogU3RhY2tpbmdPcmRlci5UT0FTVEVSLFxuICBwb2ludGVyRXZlbnRzOiAnbm9uZSdcbn0pXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvYXN0TWFuYWdlciBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIEZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSBgdGhpcy5ub3RpZnlgIGZ1bmN0aW9uLlxuICAgICAqL1xuICAgIGJpbmROb3RpZnk6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjYWxsZWQgd2l0aCB0aGUgYHRoaXMuZ2V0VG9hc3RzYCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBiaW5kR2V0VG9hc3RzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gY2FsbGVkIHdpdGggdGhlIGB0aGlzLmNsb3NlQWxsYCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBiaW5kQ2xvc2VBbGw6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbiAgfVxuXG4gIHN0YXRpYyBpZENvdW50ZXIgPSAwXG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dClcblxuICAgIHByb3BzLmJpbmROb3RpZnkodGhpcy5ub3RpZnkpXG4gICAgcHJvcHMuYmluZEdldFRvYXN0cyh0aGlzLmdldFRvYXN0cylcbiAgICBwcm9wcy5iaW5kQ2xvc2VBbGwodGhpcy5jbG9zZUFsbClcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB0b2FzdHM6IFtdXG4gICAgfVxuICB9XG5cbiAgZ2V0VG9hc3RzID0gKCkgPT4ge1xuICAgIHJldHVybiB0aGlzLnN0YXRlLnRvYXN0c1xuICB9XG5cbiAgY2xvc2VBbGwgPSAoKSA9PiB7XG4gICAgdGhpcy5nZXRUb2FzdHMoKS5mb3JFYWNoKHRvYXN0ID0+IHRvYXN0LmNsb3NlKCkpXG4gIH1cblxuICBub3RpZnkgPSAodGl0bGUsIHNldHRpbmdzKSA9PiB7XG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNyZWF0ZVRvYXN0SW5zdGFuY2UodGl0bGUsIHNldHRpbmdzKVxuXG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2aW91c1N0YXRlID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvYXN0czogW2luc3RhbmNlLCAuLi5wcmV2aW91c1N0YXRlLnRvYXN0c11cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIGluc3RhbmNlXG4gIH1cblxuICBjcmVhdGVUb2FzdEluc3RhbmNlID0gKHRpdGxlLCBzZXR0aW5ncykgPT4ge1xuICAgIGNvbnN0IGlkID0gKytUb2FzdE1hbmFnZXIuaWRDb3VudGVyXG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQsXG4gICAgICB0aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBzZXR0aW5ncy5kZXNjcmlwdGlvbixcbiAgICAgIGhhc0Nsb3NlQnV0dG9uOiBzZXR0aW5ncy5oYXNDbG9zZUJ1dHRvbiB8fCB0cnVlLFxuICAgICAgZHVyYXRpb246IHNldHRpbmdzLmR1cmF0aW9uIHx8IDUsXG4gICAgICBjbG9zZTogKCkgPT4gdGhpcy5jbG9zZVRvYXN0KGlkKSxcbiAgICAgIGludGVudDogc2V0dGluZ3MuaW50ZW50XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgd2lsbCBzZXQgaXNTaG93biBvbiB0aGUgVG9hc3Qgd2hpY2ggd2lsbCBjbG9zZSB0aGUgdG9hc3QuXG4gICAqIEl0IHdvbid0IHJlbW92ZSB0aGUgdG9hc3QgdW50aWwgb25FeGl0ZWQgdHJpZ2dlcnMgb25SZW1vdmUuXG4gICAqL1xuICBjbG9zZVRvYXN0ID0gaWQgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUocHJldmlvdXNTdGF0ZSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b2FzdHM6IHByZXZpb3VzU3RhdGUudG9hc3RzLm1hcCh0b2FzdCA9PiB7XG4gICAgICAgICAgaWYgKHRvYXN0LmlkID09PSBpZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4udG9hc3QsXG4gICAgICAgICAgICAgIGlzU2hvd246IGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0b2FzdFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICByZW1vdmVUb2FzdCA9IGlkID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHByZXZpb3VzU3RhdGUgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG9hc3RzOiBwcmV2aW91c1N0YXRlLnRvYXN0cy5maWx0ZXIodG9hc3QgPT4gdG9hc3QuaWQgIT09IGlkKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxzcGFuIGNsYXNzTmFtZT17d3JhcHBlckNsYXNzfT5cbiAgICAgICAge3RoaXMuc3RhdGUudG9hc3RzLm1hcCgoeyBpZCwgZGVzY3JpcHRpb24sIC4uLnByb3BzIH0pID0+IHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPFRvYXN0IGtleT17aWR9IG9uUmVtb3ZlPXsoKSA9PiB0aGlzLnJlbW92ZVRvYXN0KGlkKX0gey4uLnByb3BzfT5cbiAgICAgICAgICAgICAge2Rlc2NyaXB0aW9ufVxuICAgICAgICAgICAgPC9Ub2FzdD5cbiAgICAgICAgICApXG4gICAgICAgIH0pfVxuICAgICAgPC9zcGFuPlxuICAgIClcbiAgfVxufVxuIl19